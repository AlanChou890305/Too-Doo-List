<!DOCTYPE html>
<html>
<head>
    <title>Test Callback</title>
</head>
<body>
    <h1>Testing Callback Logic</h1>
    <p>Current URL: <span id="currentUrl"></span></p>
    <p>Parsed Parameters:</p>
    <pre id="params"></pre>
    <p>Redirect URL:</p>
    <pre id="redirectUrl"></pre>

    <script>
        document.getElementById('currentUrl').textContent = window.location.href;
        
        // Same logic as callback.html
        function getAuthParams() {
            let params;
            if (window.location.hash) {
                const hash = window.location.hash.substring(1);
                params = new URLSearchParams(hash);
            } else {
                params = new URLSearchParams(window.location.search);
            }

            return {
                access_token: params.get("access_token"),
                refresh_token: params.get("refresh_token"),
                expires_in: params.get("expires_in"),
                token_type: params.get("token_type"),
                code: params.get("code"),
                state: params.get("state"),
                error: params.get("error"),
                error_description: params.get("error_description"),
            };
        }

        const authParams = getAuthParams();
        document.getElementById('params').textContent = JSON.stringify(authParams, null, 2);

        let redirectUrl = '';
        if (authParams.access_token && authParams.refresh_token) {
            redirectUrl = `com.cty0305.too.doo.list://auth/callback#access_token=${authParams.access_token}&refresh_token=${authParams.refresh_token}&expires_in=${authParams.expires_in}&token_type=${authParams.token_type}`;
        } else if (authParams.code) {
            redirectUrl = `com.cty0305.too.doo.list://auth/callback?code=${authParams.code}&state=${authParams.state || ''}`;
        } else {
            redirectUrl = `com.cty0305.too.doo.list://auth/callback?error=missing_auth_params&error_description=No access token or authorization code received`;
        }

        document.getElementById('redirectUrl').textContent = redirectUrl;
    </script>
</body>
</html>
