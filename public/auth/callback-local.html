<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Local Test Callback</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f5f5f5;
      }
      .container {
        text-align: center;
        padding: 20px;
      }
      .test-button {
        background-color: #6c63ff;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        margin: 10px;
      }
      .test-button:hover {
        background-color: #5a52d5;
      }
      .debug {
        background: #f0f0f0;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        text-align: left;
        font-family: monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>ðŸ§ª Local Deep Link Test</h2>
      <p>Test deep link handling with mock OAuth code</p>

      <button class="test-button" onclick="testDirectTokens()">
        Test Direct Token Flow
      </button>

      <button class="test-button" onclick="testPKCEFlow()">
        Test PKCE Code Flow
      </button>

      <button class="test-button" onclick="testError()">Test Error Flow</button>

      <div class="debug" id="debug"></div>
    </div>

    <script>
      const debugEl = document.getElementById("debug");

      function log(message, data) {
        const logEntry = `[${new Date().toISOString()}] ${message}`;
        console.log(logEntry, data || "");
        debugEl.innerHTML +=
          logEntry + (data ? ": " + JSON.stringify(data) : "") + "\n";
        debugEl.scrollTop = debugEl.scrollHeight;
      }

      function redirectToApp(url) {
        log("Redirecting to app", url);
        try {
          window.location.href = url;
        } catch (e) {
          log("Redirect failed", e.message);
        }
      }

      function testDirectTokens() {
        log("Testing direct token flow");
        const mockTokens = {
          access_token: "mock_access_token_" + Date.now(),
          refresh_token: "mock_refresh_token_" + Date.now(),
          expires_in: 3600,
          token_type: "bearer",
        };

        const redirectUrl = `com.cty0305.too.doo.list://auth/callback#access_token=${mockTokens.access_token}&refresh_token=${mockTokens.refresh_token}&expires_in=${mockTokens.expires_in}&token_type=${mockTokens.token_type}`;

        redirectToApp(redirectUrl);
      }

      function testPKCEFlow() {
        log("Testing PKCE code flow");
        const mockCode = "mock_auth_code_" + Date.now();
        const mockState = "mock_state_" + Date.now();

        const redirectUrl = `com.cty0305.too.doo.list://auth/callback?code=${mockCode}&state=${mockState}`;

        redirectToApp(redirectUrl);
      }

      function testError() {
        log("Testing error flow");
        const redirectUrl = `com.cty0305.too.doo.list://auth/callback?error=access_denied&error_description=User denied access`;

        redirectToApp(redirectUrl);
      }

      log("Local test callback page loaded");
    </script>
  </body>
</html>
